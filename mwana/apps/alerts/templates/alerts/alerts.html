{# TODO: Find a better way of displaying the alerts to avoid repeating code #}
{% extends "layout.html" %}
{% load forms_tags %}

{% block title %}Mwana Alerts - {{ block.super }}{% endblock %}

{% block javascripts %}
{{ block.super }}
{% endblock %}

{% block stylesheets %}
{{ block.super }}
<link type="text/css" rel="stylesheet" href="{{ MEDIA_URL }}stylesheets/modules.css" />
<link type="text/css" rel="stylesheet" href="{{ MEDIA_URL }}locations/stylesheets/locations.css" />
<link type="text/css" rel="stylesheet" href="{{ MEDIA_URL }}locations/stylesheets/label-overlay.css" />
<link type="text/css" rel="stylesheet" href="{{ MEDIA_URL }}labresults/stylesheets/labresults.css" />
{% endblock %}

{% block content %}

<form name="form1">
    <div class="split-2">
        <div class="left">
            <div class="module">
                <h2>Results160 Alerts on {% now "jS F Y" %} at {% now "H:i" %}</h2>
                <br>
                Generated by <b>{{ user.username|title }}</b>
                <hr>
                                
                           {% if region_selectable %}
                <p>Select Region: &nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Province&nbsp;: {% autoescape off %}
                    {{rpt_provinces}}
                    {% endautoescape %}&nbsp;
                    or District:{% autoescape off %}
                    {{rpt_districts}}
                    {% endautoescape %}&nbsp;(Note: District overrides Province)

                    {% if is_report_admin %}
                <p>Select Implementer:
                    {% autoescape off %}
                    {{rpt_group}}
                    {% endautoescape %}
                    &nbsp;
                    {%endif%}
                    {%endif%}

                    &nbsp;&nbsp;&nbsp; <input type="submit" value="Ok" name="SubmitValues" />

               
                <hr>
                <h1>Clinic Issues:</h1>
                <div>
                    <!-- Report 1-->
                    <p align="center">
                    <h3>Alerts for Clinics Not Retrieving Results in the last {{ retrieving_time }} days</h3>
                    <br>Select date range (days)
                    <select name="input_retrieving_time" size="1">
                        {% for a in days%}
                        {% ifequal a retrieving_time%}
                        <option selected value="{{a}}">{{a}}</option>
                        {% else%}
                        <option value="{{a}}">{{a}}</option>
                        {% endifequal %}
                        {%endfor%}

                    </select>
                    <input type="submit" value="Update" name="SubmitValues2" />
                    <p align="center">
                    {% for record in not_retrieving_results %}
                    <table border="1" width="100%">
                            <tr>
                                {% ifequal record.level record.HIGH_LEVEL %}
                                <td width="50" bgcolor="#FF0000"></td>
                                {% else%}
                                <td width="50" bgcolor="#FFFF00"></td>
                                {% endifequal%}
                                <td width="50" bgcolor="#FFFFFF" align="center"><font size="6">{{ record.days_late }}</font><br>&nbsp;&nbsp;days</td>
                                <td width="80" bgcolor="#EBEBEB">{{ record.culprit }}</td>
                                <td bgcolor="#FFFFFF">{{ record.message }} <b>{{ record.extra }}</b></td>
                            </tr>
                        </table>
                        {% endfor %}

                    <p><p>
                    <hr>
                        <!-- Report 2-->
                    <p align="center">
                    <h3>Alerts for Clinics Not Sending DBS Samples or using Results160 in the last {{ notifying_time }} days</h3>
                    <br>Select date range (days)
                    <select name="input_notifying_time" size="1">
                        {% for a in days%}
                        {% ifequal a notifying_time %}
                        <option selected value="{{a}}">{{a}}</option>
                        {% else%}
                        <option value="{{a}}">{{a}}</option>
                        {% endifequal %}
                        {%endfor%}

                    </select>

                    <input type="submit" value="Update" name="SubmitValues2" />
                        <p>
                        {% for record in not_notifying_or_using_results %}

                        <table border="1"  width="100%">
                            <tr>
                                {% ifequal record.level record.HIGH_LEVEL %}
                                <td width="50" bgcolor="#FF0000"></td>
                                {% else%}
                                <td width="50" bgcolor="#FFFF00"></td>
                                {% endifequal%}
                                <td width="50" bgcolor="#FFFFFF" align="center"><font size="6">{{ record.days_late }}</font><br>&nbsp;&nbsp;days</td>
                                <td width="80" bgcolor="#EBEBEB">{{ record.culprit }}</td>
                                <td bgcolor="#FFFFFF">{{ record.message }} <b>{{ record.extra }}</b></td>
                            </tr>
                        </table>
                        {% endfor %}

                    <p><p>
                    <hr>
                    <!--Resport3-->
                    <h1>Hub Issues:</h1>
                    <p align="center">
                    <h3>Alerts for Clinic Hubs Not Sending Samples to Labs in the last {{ transport_time }} days</h3>
                    <br>
                    Select date range (days)
                    <select name="input_transport_time" size="1">
                        {% for a in days%}
                        {% ifequal a transport_time%}
                        <option selected value="{{a}}">{{a}}</option>
                        {% else%}
                        <option value="{{a}}">{{a}}</option>
                        {% endifequal %}
                        {%endfor%}

                    </select>

                    <input type="submit" value="Update" name="SubmitValues" />


                    <p>
                        {% for record in not_sending_dbs_alerts %}
                        <table border="1"  width="100%">
                            <tr>
                                {% ifequal record.level record.HIGH_LEVEL %}
                                <td width="50" bgcolor="#FF0000"></td>
                                {% else%}
                                <td width="50" bgcolor="#FFFF00"></td>
                                {% endifequal%}
                                <td width="50" bgcolor="#FFFFFF" align="center"><font size="6">{{ record.days_late }}</font><br>&nbsp;&nbsp;days</td>
                                <td width="80" bgcolor="#EBEBEB">{{ record.culprit }}</td>
                                <td bgcolor="#FFFFFF">{{ record.message }} <b>{{ record.extra }}</b></td>
                            </tr>
                        </table>
                        {% endfor %}

                    <p><p>
                    <hr>
                    <h1>Lab Issues:</h1>
                    <!-- Alert Report 4-->
                    <p align="center">
                    <h3>Alerts for Labs Not Processing DBS samples in the last {{ lab_processing_days }} days.</h3>
                    <br>Select date range (days)
                    <select name="input_lab_processing_days" size="1">
                        {% for a in days%}
                        {% ifequal a lab_processing_days %}
                        <option selected value="{{a}}">{{a}}</option>
                        {% else%}
                        <option value="{{a}}">{{a}}</option>
                        {% endifequal %}
                        {%endfor%}

                    </select>

                    <input type="submit" value="Update" name="SubmitValues2" />

                        <p>
                        {% for record in not_processing_dbs %}
                        <table border="1"  width="100%">
                            <tr>
                                {% ifequal record.level record.HIGH_LEVEL %}
                                <td width="50" bgcolor="#FF0000"></td>
                                {% else%}
                                <td width="50" bgcolor="#FFFF00"></td>
                                {% endifequal%}
                                <td width="50" bgcolor="#FFFFFF" align="center"><font size="6">{{ record.days_late }}</font><br>&nbsp;&nbsp;days</td>
                                <td width="80" bgcolor="#EBEBEB">{{ record.culprit }}</td>
                                <td bgcolor="#FFFFFF">{{ record.message }} <b>{{ record.extra }}</b></td>
                            </tr>
                        </table>
                        {% endfor %}

                    <p><p>
                    <hr>
                        <!-- Alert Report 5-->
                    <p align="center">
                    <h3>Alerts for Labs Not Sending Payloads in the last {{ lab_sending_days }} days.</h3>
                    <br>Select date range (days)
                    <select name="input_lab_sending_days" size="1">
                        {% for a in days%}
                        {% ifequal a lab_sending_days %}
                        <option selected value="{{a}}">{{a}}</option>
                        {% else%}
                        <option value="{{a}}">{{a}}</option>
                        {% endifequal %}
                        {%endfor%}

                    </select>

                    <input type="submit" value="Update" name="SubmitValues2" />

                     <p>
                        {% for record in not_sending_dbs %}
                        <table border="1"  width="100%">
                            <tr>
                                {% ifequal record.level record.HIGH_LEVEL %}
                                <td width="50" bgcolor="#FF0000"></td>
                                {% else%}
                                <td width="50" bgcolor="#FFFF00"></td>
                                {% endifequal%}
                                <td width="50" bgcolor="#FFFFFF" align="center"><font size="6">{{ record.days_late }}</font><br>&nbsp;&nbsp;days</td>
                                <td width="80" bgcolor="#EBEBEB">{{ record.culprit }}</td>
                                <td bgcolor="#FFFFFF">{{ record.message }} <b>{{ record.extra }}</b></td>
                            </tr>
                        </table>
                        {% endfor %}
                    <p><p>
                </div>
                <p>
            </div>
            <div class="clear-hack"></div>
        </div>
    </div>
</form>{% endblock %}
