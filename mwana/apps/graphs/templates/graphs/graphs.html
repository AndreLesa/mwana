{% extends "layout.html" %}
{% load forms_tags %}

{% block title %}Charts - {{ block.super }}{% endblock %}

{% block stylesheets %}
{{ block.super }}
<link type="text/css" rel="stylesheet" href="{{ MEDIA_URL }}reports/stylesheets/chosen.css" />
<link type="text/css" rel="stylesheet" href="{{ MEDIA_URL }}reports/stylesheets/jquery-ui-1.10.2.redmond.min.css" />
<!--<link type="text/css" rel="stylesheet" href="{{ MEDIA_URL }}reports/stylesheets/bootstrap-responsive.min.css" />
<link type="text/css" rel="stylesheet" href="{{ MEDIA_URL }}reports/stylesheets/bootstrap.min.css" />-->
{% endblock %}

{% block javascripts %}
<script type="text/javascript" src="{{ MEDIA_URL }}reports/javascripts/location_selector.js" ></script>
<script type="text/javascript" src="{{ MEDIA_URL }}reports/javascripts/jquery-1.8.0.min.js" ></script>
<script type="text/javascript" src="{{ MEDIA_URL }}reports/javascripts/chosen.jquery.min.js" ></script>
<script type="text/javascript" src="{{ MEDIA_URL }}reports/javascripts/jquery-ui-1.8.23.custom.min.js" ></script>


<script type="text/javascript"  src="{{ MEDIA_URL }}reports/javascripts/highcharts.js"></script>
<script type="text/javascript"  src="{{ MEDIA_URL }}reports/javascripts/modules/exporting.js"></script>

<script type="text/javascript">
    
    $(document).ready(function() {
        $('.report').bind('click', function () {
            document.getElementById("graph").innerHTML = '<div align="center">\n\
    <img src="{{ MEDIA_URL }}reports/images/spinner.gif" align="left" style="padding: 5em 1em 5em 5em; vertical-align: middle"/>\n\
    <img src="{{ MEDIA_URL }}reports/images/spinner.gif" align="middle" style="padding: 5em 1em 5em 5em; vertical-align: middle"/>Please wait...\n\
    <img src="{{ MEDIA_URL }}reports/images/spinner.gif" align="right" style="padding: 5em 1em 5em 5em; vertical-align: middle"/>\n\
</div>';
            $.get("/graphs/"+this.id+"?start_date="+
                document.getElementById("startdate").value+"&end_date="+
                document.getElementById("enddate").value+"&rpt_provinces="+
                document.getElementById("rpt_provinces").value+"&rpt_districts="+
                document.getElementById("rpt_districts").value+"&rpt_facilities="+
                document.getElementById("rpt_facilities").value
            , function(data) {
                

                $('#graph')[0].innerHTML=data;
                checkIfLoggedOutAndRefresh()
                eval(document.getElementById("runscript").innerHTML);
                
            });
        });
    });
</script>
<script type="text/javascript" >
    $(function(){
        $(".datefield").datepicker({ dateFormat: 'yy-mm-dd' })
        $.datepicker.formatDate
    });
</script>
<script type="text/javascript" >
    function checkIfLoggedOutAndRefresh(){
        password_field = document.getElementById('id_password')
        username_field = document.getElementsByName('username')
        
        if(password_field && username_field){
            document.getElementById('graph').innerHTML = '<strong><p>Sorry, your session has expired. You have to log in again.</strong>'
            $("<div>Sorry, your session has expired. You need to log in again.</div>").dialog({
                draggable: false,
                resizable: false,
                modal: true,
                buttons: {
                    Ok: function() {
                        $(this).dialog("close");
                        location.reload(true);
                    },
                    Understood: function() {
                        $(this).dialog("close");
                        location.reload(true);
                    }
                }
            });
        }
    }
</script>
{% endblock %}

{% block content %}
<div class="left">
    <div class="module">
        <h2>Charts</h2>
        <table border="0" width="100%">
            <thead>
                <tr>
                    <th colspan="2" width="30%">Period</th>
                    <th colspan="3">Location</th>
                </tr>
            </thead>
            <tbody>
            <thead>
            <th>Start</th>
            <th>End</th>
            <th>Province</th>
            <th>District</th>
            <th>Facility</th>
            </thead>
            <tr>
                <td><input type="text" id="startdate" name="startdate" class="datefield" size="9" value='{{ fstart_date }}' placeholder='{{ fstart_date }}' />
                <td><input type="text" id="enddate" name="enddate" class="datefield" size="9" value={{ fend_date }}  placeholder='{{ fend_date }}' /></td>
                <td>{% autoescape off %}
                    {{rpt_provinces}}
                    {% endautoescape %}
                </td>
                <td>{% autoescape off %}
                    {{rpt_districts}}
                    {% endautoescape %}
                </td>
                <td>{% autoescape off %}
                    {{rpt_facilities}}
                    {% endautoescape %}
                </td>
            </tr>
            <tr>
                <td colspan="5">
                    <div >
                        <a class="report" id="lab_submissions">Daily Lab Submissions</a>
                        |  <a class="report" id="monthly_lab_submissions">Monthly Lab Submissions</a>
                        | <a class="report" id="facility_vs_community" disabled="false" >Facility vs Community Births</a>
                        | <a class="report" id="turnaround" disabled="false" >DBS Turnaround</a>
                        | Birth Trends
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
        <div>

            <div class="module">

                <div id="graph" align="center">                    
                    <div class="info" style="padding: 5em" align="center">
                        <br><strong>Click on a link above to display the corresponding graph.</strong>
                    </div>
                </div>
            </div>
        </div>
        <div class="clear-hack"></div>
    </div>
</div>
<div id="resources" style="display: None">
    <img src="{{ MEDIA_URL }}reports/images/spinner.gif" align="middle" style="padding: 5em"/>
</div>
<script type="text/javascript">
    $("#rpt_group").chosen();
    $("#worker_types").chosen();
</script>
{% endblock %}
